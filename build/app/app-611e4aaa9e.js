"use strict";angular.module("crowdferenceApp",["ngTouch","ui.bootstrap","ngRoute","pascalprecht.translate","ga","monospaced.elastic","hc.marked","ngSanitize"]).config(["$routeProvider","$locationProvider",function(e,t){e.otherwise({redirectTo:"/_"}),t.html5Mode(!0),t.hashPrefix("!")}]).config(["msdElasticConfig",function(e){e.append="\n\n"}]).config(["$translateProvider",function(e){e.useSanitizeValueStrategy("escapeParameters"),e.useStaticFilesLoader({prefix:"https://rawgit.com/crowdference/babel/master/",suffix:".json"}),e.fallbackLanguage("en");var t=window.navigator.userLanguage||window.navigator.language||"es";e.preferredLanguage(t)}]).config(["markedProvider",function(e){var t=new window.marked.Renderer;t.heading=function(e,t){return'<div class="md-h'+t+'">'+e+"</div>"},t.link=function(e,t,n){return'<a target="_blank" rel="nofollow" href="'+e+'"'+(t&&' title="'+t+'"')+">"+n+"</a>"},e.setOptions({renderer:t,breaks:!0,smartLists:!0})}]).run(["$rootScope","User","Question","Area","$location","$modal",function(e,t,n,a,i,s){e.goToUser=function(e,n){n=n||a.view||{},t.view=e,a.view=n,i.$$search={},i.path("/user/"+e._id+"/"+(n.url||"_"))},e.goToQuestion=function(e){n.view=e,a.view=e.area,i.$$search={},i.path("/question/"+e._id)},e.goToArea=function(e){a.view=e,i.$$search={},i.path(e._url||"_")},e.canIedit=function(e){return a.current&&a.current.permissions&&a.current.permissions.moderate||n.view&&n.view.area&&n.view.area.permissions.moderate||t.user._id===e._id||t.user.users.some(function(t){return t._id===e._id})},e.Area=a,e.showVotes=function(e){s.open({templateUrl:"components/votes/showVotes.html",controller:["$scope","$rootScope",function(t,n){t.votes=e,n.$on("$locationChangeSuccess",function(){t.$close()})}],size:"lg"})}}]),_.empty=function(e){_.forOwn(e,function(t,n){delete e[n]})},angular.module("crowdferenceApp").run(["$templateCache",function(e){e.put("app/auth/authview.html",""),e.put("app/login/login.html",'<div id=login><div id=landing><div class=info><div translate=info></div></div><div class=login><div ng-hide="user && user.profile.type!==\'email\'"><h4 translate=mail_title></h4><p><div class=input-group><input type=email class=form-control ng-model=email> <span class=input-group-btn><button class="btn btn-default" type=button ng-click=sendCode(email) translate=mail_button></button></span></div></p><h4 ng-show="hmac && session" translate=mail_confirm_title></h4><div ng-show="hmac && session" class=input-group><input type=text ng-model=code class=form-control> <span class=input-group-btn><a target=_self class="btn btn-default" ng-href=/api/auth/email/{{code}}/{{hmac}}/{{session}} translate=mail_confirm_button></a></span></div><p></p></div><h4 ng-hide=user ng-if=anyOauth() translate=oauth></h4><a ng-if="oauth.url && !user" ng-repeat="oauth in oauths" target=_self ng-href={{oauth.url}}><img class=clickable ng-src=/assets/images/{{oauth.icon}}></a> <a ng-if="oauth.url && user" ng-repeat="oauth in oauths"><div ng-show=user><user-card user=user href={{oauth.url}}></user-card></div></a><div ng-if=anyOauth() translate=safe></div><div ng-hide=login translate=cookies></div><div translate=terms></div><h4 translate={{guest_title}}></h4><button class="btn btn-default" ng-click=guest() translate={{guest_button}}></button></div></div></div>'),e.put("app/login/loginCallback.html",""),e.put("app/main/main.html","<div class=bigArea><area><primary></primary><div style=height:150px></div></div>"),e.put("app/search/search.html","<div class=bigArea><user-view></user-view><primary></primary><div style=height:150px></div></div>"),e.put("app/question/question.html",'<div id=question class=bigArea><div id=questionArea><div class=title><a class=pull-right ng-click="goToUser(question.target, question.area)"><img ng-src={{question.target.image}}></a> <a class=pull-right ng-click="goToUser(question.user, question.area)"><img ng-src={{question.user.image}}><br></a><p class=from>{{question.user.name || question.user.nick || \'---\'}}</p><h2><span translate=target></span> {{question.target.name}}</h2></div><div class=question><div class=text><history-editable save="save(\'question\', $value)" what=question history=question.question user=question.user></history-editable></div></div><div class=response><div class=title><h2 ng-if=question.isAnswered><span translate=answer></span></h2><h2 ng-if=!question.isAnswered><span translate=toAnswer></span></h2></div><div><div class=responseArea><div class=text ng-if="question.isAnswered || canIedit(question.target)"><history-editable save="save(\'answer\', $value)" what=answer history=question.answer user=question.target></history-editable></div><div ng-if="!question.isAnswered && !canIedit(question.target)" class=text><div class=horizontalcenter><div class=verticalcenter><a class="clickable claim" ng-href="/sys/login?target=true"><span translate-values={name:question.target.name||question.target.nick} translate=iAm></span></a></div></div></div></div><div class=clearfix></div></div></div></div><div class=footer><div id=f1><div class="crowdits clickable" ng-click=showVotes(question.votes)>{{question.votes.count}} crowdits</div></div><div id=f2><img class=clickable ng-click="popup(\'twitter\')" src=/assets/images/tw.png> <img class=clickable ng-click="popup(\'facebook\')" src=/assets/images/fb.png> <img class=clickable ng-click="popup(\'google\')" src=/assets/images/g+.png></div><div id=f3><div ng-show="quesiont.area.permissions.ask || question.area.custom.tryToAsk" ng-click=vote() ng-class={voted:checkVoted()} class="crowdIt clickable"></div></div></div><div class=clearfix></div><div ng-if=question._id class=commentsArea><comments owner=question></comments></div></div>'),e.put("app/user/user.view.html","<div><div class=bigArea><user-view></user-view><area><primary></primary></div></div>"),e.put("components/area/area.html","<div id=area ng-if=\"area.url!=='_' && area.url!==undefined\"><img style=width:150px ng-src={{area.image}}><h3><span ng-bind=area.name></span></h3><markdown-area class=aboutMe edit=false ng-model=area.description></markdown-area><div class=clearfix></div></div>"),e.put("components/comments/comment.html",'<div class=comment><div id=comment-{{comment.count}} class=panel><div class=panel-body><div class=number><div class=votes style=text-align:center><a ng-show="question.area.custom.tryToAsk || question.area.permissions.ask" ng-click="vote(comment, 1)"><i class="fa fa-plus"></i></a><br><a ng-click=showVotes(comment.votes)><span>{{comment.votes.count}}</span></a><br><a ng-show="question.area.custom.tryToAsk || question.area.permissions.ask" ng-click="vote(comment, -1)"><i class="fa fa-minus"></i></a><br></div></div><div class=foto><img ng-click=goToComment(12) _ng-click="goToUser(comment.user, question.area)" ng-src={{comment.user.image}}></div><div class=comment-content><div class=pull-left><a class=author ng-click=respondTo(comment)><b>#{{comment.count}}</b></a> <a class=author ng-click="goToUser(comment.user, question.area)">{{comment.user.name || comment.user.nick || \'---\'}}</a></div><div class=clearfix></div><article><history-editable hide-bar=true current=current what=comment history=comment.comment render=render($content) save="edit(comment, $value)" user=comment.user controls=controls></history-editable></article></div></div><div class=panel-footer><a ng-show="question.area.permissions.ask || question.area.custom.tryToAsk" class=text-crowdIt ng-click=toogleNewComment()><i ng-class="{\'fa-rotate-270\':status.respond}" class="fa fa-2x fa-reply"></i></a> &nbsp;&nbsp; <a class=text-crowdIt ng-if=comment.children.length ng-click=childrenToggle()><div style=display:inline-block; class=fa-flip-vertical><i ng-class="{\'fa-rotate-90\':status.showChildren,\'fa-rotate-180\':!status.showChildren }" class="fa fa-2x fa-reply-all"></i></div><span>{{comment.children.length}}</span></a><div class=bar><div class=pull-left><i ng-show=controls.hasprev() ng-click=controls.prev() class="fa fa-chevron-left"></i></div><i ng-show=controls.editing ng-click=controls.ok() class="fa fa-check"></i> <span>{{current.timestamp |date : \'dd-MM-yyyy hh:mm\'}}</span> <i ng-show=controls.editing ng-click=controls.cancel() class="fa fa-times"></i> <i ng-if="!controls.editing && $root.canIedit(comment.user)" ng-click=controls.edit() class="fa fa-edit"></i><div ng-if=current.moderated class=pull-right><span class="fa fa-gavel"></span> <span translate=moderated></span></div><div class=pull-right><i ng-show=controls.hasnext() ng-click=controls.next() class="fa fa-chevron-right"></i></div><div class=clearfix></div></div></div><div class=clearfix></div></div></div><div collapse=!status.respond class=children><new-comment comment=comment.response comments=comments parent-status=status></new-comment></div><div collapse=!status.showChildren class=children><div ng-if="status.showChildren!==undefined" ng-repeat="comment in comment.children track by comment._id"><comment></comment></div></div>'),e.put("components/comments/comments.html",'<div><h3 class=comments-title><span translate=comments_title></span> {{question.comments.count}}</h3><div ng-repeat="comment in question.comments.comments track by comment._id"><comment></comment></div><new-comment></new-comment><div style=height:150px></div></div>'),e.put("components/comments/newComment.html",'<div class=comment ng-show="question.area.permissions.ask || question.area.custom.tryToAsk"><div class=panel><div class=panel-body><div ng-if=user._id class=foto><img ng-src={{user.image}}></div><div class=comment-content><div ng-if=user._id class=pull-left><a class=author ng-href=/{{area}}{{user.url}}>{{user.name}}</a></div><div class=clearfix></div><article><textarea msd-elastic class=form-control ng-model=newComment></textarea></article><a class=text-success ng-click=save()><i class="fa fa-2x fa-check"></i></a> &nbsp;&nbsp; <a class=text-danger ng-click="newComment = \'\'"><i class="fa fa-2x fa-times"></i></a></div></div></div></div>'),e.put("components/historyEditable/historyEditable.html",'<div class=historyEditable><div ng-if=renderize class=historyview ng-hide=controls.editing></div><div ng-if=!renderize ng-hide=controls.editing><div marked=current[what]></div></div><textarea class=form-control ng-if=controls.editing ng-model=controls.editing.value msd-elastic></textarea><div ng-if=!hideBar class=bar><div class=pull-left><i ng-show=controls.hasprev() ng-click=controls.prev() class="fa fa-chevron-left"></i></div><i ng-show=controls.editing ng-click=controls.ok() class="fa fa-check"></i> <span>{{current.timestamp |date : \'dd-MM-yyyy hh:mm\'}}</span> <i ng-show=controls.editing ng-click=controls.cancel() class="fa fa-times"></i> <i ng-if="!controls.editing && $root.canIedit(user)" ng-click=controls.edit() class="fa fa-edit"></i><div ng-if=current.moderated class=pull-right><span class="fa fa-gavel"></span> <span translate=moderated></span></div><div class=pull-right><i ng-show=controls.hasnext() ng-click=controls.next() class="fa fa-chevron-right"></i></div><div class=clearfix></div></div></div>'),e.put("components/inlineQuestion/inlineQuestion.html",'<div id=inlineQuestion ng-show="Area.permissions.ask || Area.custom.tryToAsk"><input ng-if=!Area.custom.targets ng-keyup=enter($event)&&search() ng-hide=question.target.url ng-model=target uib-typeahead="suggest for suggest in getSuggestions($viewValue)" typeahead-loading=cargando typeahead-template-url=components/inlineQuestion/suggest.html typeahead-wait-ms=100 typeahead-search=typesearch typeahead-on-select="target=select($model)" placeholder="{{\'inlineQuestion_target\'|translate}}"><div ng-if=Area.custom.targets class="target clickable" uib-dropdown uib-dropdown-toggle ng-click=updateTargets() ng-hide=question.target.url><div class=media><span class=close><i class="fa fa-chevron-down"></i></span><div class=media-body><h4 class=media-heading>Selecciona el destinatario</h4></div></div><ul class=uib-dropdown-menu><li ng-repeat="target in targets"><div class=suggest ng-click=select(target)><div class=pull-left><img style=width:50px class=media-object ng-src={{target.image}}></div><div class=media-body><h4 class=media-heading>{{target.name}}</h4></div><div class=clearfix></div></div></li></ul></div><div class=target ng-show=question.target.url><div class=media><span class=close ng-click=chooseAgain()>&times;</span><div class=pull-left><img style=width:50px class=media-object ng-src={{question.target.image}}></div><div class=media-body><h4 class=media-heading>{{question.target.name || question.target.nick}}</h4></div></div></div><markdown-area ng-model=question.question placeholder="{{\'inlineQuestion_question\'|translate}}" active=questionActive editable=true></markdown-area><div ng-class={error:questionMaxLength<question.question.length} class=info>{{questionMaxLength-question.question.length}}</div><div class=clearfix></div><div class=footer><div ng-class="{error:question.question.length===0 || shortMaxLength<question.short.length || !question.target}" class="crowdIt clickable" ng-click=crowdIt()></div></div></div>'),e.put("components/inlineQuestion/search.html",'<div class=modal-header><h3 ng-if=!questions class=modal-title>Comprobando si existen preguntas similares:</h3><h3 ng-if=questions class=modal-title>Preguntas similares encontradas:</h3></div><div class=modal-body><div class="panel panel-default"><div class=panel-body><h4>Es mejor sumar que dividir.</h4><p>Si alguna de las siguientes preguntas se parece a la tuya, vótala y entra para ver los comentarios.</p><p>Es posible que hasta ya esté respondida :)</p></div></div><div ng-if=questions.length class="panel panel-default"><div class=panel-body><div ng-if=questions.length ng-repeat="question in questions track by question._id"><question-card question=question></question-card></div></div></div></div><div class=modal-footer><button class="btn btn-primary" ng-click=ok()>Quiero publicar mi pregunta.</button> <button class="btn btn-warning" ng-click=cancel()>No es necesario publicar mi pregunta.</button></div>'),e.put("components/inlineQuestion/suggest.html",'<div><div class=suggest ng-if=match.model.search><div class=pull-right><i class="fa fa-fw fa-2x fa-search"></i></div><div class=media-body><h4 class=media-heading translate=snsearch></h4></div></div><div class=suggest ng-if=match.model.notFound><div class=pull-right><i class="fa fa-fw fa-2x fa-times"></i></div><div class=media-body><h4 class=media-heading translate=notFound></h4></div></div><div class=suggest ng-if=match.model.url><div class=pull-left><img style=width:50px class=media-object ng-src={{match.model.image}}></div><div class=media-body><h4 class=media-heading>{{match.model.name || match.model.nick || \'---\'}}</h4><a target=_blank ng-href={{match.model.url}} ng-bind=match.model.url></a></div><div class=clearfix></div></div></div>'),e.put("components/languages/index.html",'<div class=languages><div uib-dropdown><div class=button uib-dropdown-toggle><span translate=name></span> <i class="fa fa-language"></i></div><ul class=uib-dropdown-menu><li ng-repeat="translation in translations"><a ng-click=use(translation.lang) ng-bind=translation.name></a></li></ul></div></div>'),e.put("components/leftBar/leftBar.html","<div id=leftBar class=left><user-area></user-area><inline-question></inline-question><params-nav key=which></params-nav><params-nav key=sort></params-nav><params-nav key=as></params-nav></div>"),e.put("components/markdownArea/markdownArea.html","<div><div class=markdownAreaView></div><div class=markdownAreaEditResize ng-bind=\"ngModel+' '\"></div><textarea class=markdownAreaEdit ng-model=ngModel ng-trim=false placeholder={{placeholder}}></textarea></div>"),e.put("components/notificationsBar/index.html",'<div><a href=notifications/view ng-show="user.url && user.notifications.length==0" translate=noNotifications></a> <span ng-if=user.notifications.length class=dropdown><a class=dropdown-toggle><span ng-show="user._id && user.notifications.length==1" translate=oneNotification></span> <span ng-show="user._id && user.notifications.length>1 && !user.more" translate=manyNotifications translate-values="{count : user.notifications.length}"></span> <span ng-show="user._id && user.notifications.length>1 && user.more" translate=moreNotifications translate-values="{count : user.notifications.length}"></span></a><ul class=uib-dropdown-menu><li ng-repeat="notification in user.notifications track by notification._id"><a notification=notification read=removeNotification($index)></a></li><li class=divider></li><li><a href=notifications/view translate=viewAllNotifications></a></li></ul></span></div>'),e.put("components/paramsNav/paramsNav.html",'<nav ng-hide=hide class=paramsNav><h4 translate=paramsNav_titles_{{key}}></h4><ul class="nav nav-pills nav-stacked"><li ng-class="{active:params[key] === value}" ng-repeat="value in options"><a ng-click="params[key] = value"><span translate=paramsNav_{{key}}_{{value}}></span></a></li></ul></nav>'),e.put("components/primary/primary.html",'<div class=bar ng-class=Questions.type><div class=bar-header><button class="btn pull-left" ng-click=prev()><i class="fa fa-arrow-left"></i></button> <button class="btn pull-right" ng-click=next()><i class="fa fa-arrow-right"></i></button> {{\'questionBar_\'+Questions.params.which+\'_\'+Questions.params.sort|translate}}<div class=clearfix></div></div><div ng-if=questions.length ng-repeat="question in questions track by question._id"><question-card question=question></question-card></div><div ng-if=!questions.length class=noQuestions>{{\'questionBar_\'+Questions.type+\'_\'+Questions.mode | translate}}</div><div class=bar-footer><button class="btn pull-left" ng-click=prev()><i class="fa fa-arrow-left"></i></button> <button class="btn pull-right" ng-click=next()><i class="fa fa-arrow-right"></i></button>{{\'questionBar_\'+Questions.params.which+\'_\'+Questions.params.sort|translate}}<div class=clearfix></div></div></div>'),e.put("components/questionCard/questionCard.html",'<div class=questionCard ng-class="{answer:question.isAnswered===true}"><div class=media><a ng-click="goToUser(question.target, question.area)" class=pull-left><img ng-src={{question.target.image}}></a><div class=media-body><span class=media-heading><a ng-click="goToUser(question.target, question.area)"><span class=text-primary translate=target></span> <span ng-bind=question.target.name></span></a></span> <a ng-click=goToQuestion(question)><div class=questionArea><div class=serifa style=color:#555 marked=question.question[question.question.length-1].question></div></div></a> <span class="date pull-right" style=color:grey>{{question.questionTimestamp | date:\'dd-MM-yyyy HH:mm\'}}</span> <span style=color:grey translate=comments_count translate-values="{count: question.comments.count}"></span></div></div><span class="pull-right questionCardBar" href=#><span ng-click=showVotes(question.votes) class="rank clickable">{{question.votes.count}}</span><div ng-show=question.area.custom.tryToAsk||question.area.permissions.ask ng-click=vote() ng-class={voted:checkVoted()} class="crowdIt clickable"></div></span></div>'),e.put("components/searchBox/searchBox.html",'<div id=searchBox><input ng-model=topic placeholder="{{\'moto\' | translate}}"> <span class=clickable ng-click=search()><i class="fa fa-2x fa-search"></i></span></div>'),e.put("components/searchBox/suggest.html",'<div><div class=suggest ng-if=match.model.search><div class=pull-right><i class="fa fa-fw fa-2x fa-search"></i></div><div class=media-body><h4 class=media-heading translate=search></h4></div></div><div class=suggest ng-if=match.model.subarea><div class=pull-right><img style=width:50px class=media-object ng-src={{match.model.image}}></div><div class=media-body><h4 class=media-heading>{{match.model.name}}</h4></div><div class=clearfix></div></div><div class=suggest ng-if=match.model.externalUrl><div class=pull-left><img style=width:50px class=media-object ng-src={{match.model.image}}></div><div class=media-body><h4 class=media-heading>{{match.model.name}}</h4></div><div ng-if=showAddManager()><a ng-click=addManager(match.model)>Conceder Permiso</a></div><div class=clearfix></div></div></div>'),e.put("components/topBar/topBar.html",'<div id=topBar><div class=content><div id=crowdference><a class=cleanLink href="/"><h1><img src=/assets/images/g14.png style=width:300px alt=Crowdference></h1></a></div><i ng-show=leftBarStatus.show class="fa fa-bars clickable leftBarToggle" ng-click=leftBarToggle()></i> <i ng-hide=leftBarStatus.show class="fa fa-reply clickable leftBarToggle" ng-click=back()></i><div id=moto><search-box></search-box></div><languages></languages></div><div class=links><a ng-repeat="link in area.custom.links" target={{link.target}} ng-href={{link.href}}>{{link.label}}</a></div></div>'),e.put("components/user/user.html",'<div id=profile ng-if=user._id><img style=width:150px ng-src={{user.image}}> <a target=_blank ng-href={{user.url}}><h3><i class="fa fa-external-link"></i> <span ng-bind=user.url></span><br><small ng-bind="user.name || user.nick || \'---\'"></small></h3></a><div ng-show=user.aboutMe class=aboutMe marked=user.aboutMe></div><div class=clearfix></div><div ng-if="user.managers!==undefined"><hr><h4 class=clickable ng-click="collapsed=!collapsed"><span translate=profile.managers></span><i ng-class="collapsed?\'fa-caret-up\':\'fa-caret-down\'" class=fa></i></h4><div collapse=!collapsed><ul class=list-group><li class=list-group-item ng-repeat="manager in user.managers"><button ng-click=removeManager($index) class="btn btn-danger pull-right" tooltip="{{\'remove\'|translate}}"><i class="fa fa-times"></i></button><user-card user=manager></user-card></li><li ng-if=user.managers.length<4 class=list-group-item><div class=input-group><span class=input-group-addon>añadir</span> <input class=form-control ng-model=newManager uib-typeahead="suggest for suggest in findUser($viewValue)" typeahead-loading=cargando typeahead-template-url=/components/inlineQuestion/suggest.html typeahead-wait-ms=100 typeahead-search=typesearch typeahead-on-select="addManager($model);$viewValue=\'\';newManager=\'\'" placeholder=usuario></div></li></ul></div></div></div>'),e.put("components/userArea/userArea.html","<div id=userArea><a ng-href=\"{{user._id ? ('/user/' + user._id + '/' + area.url) : '/sys/login'}}\"><img ng-src={{user.image}}></a><div><a title={{user.name}} ng-href=\"{{user._id ? ('/user/' + user._id + '/' + area.url) : '/sys/login'}}\" ng-bind=user.name></a> <a ng-show=\"user._id && user.notifications.length==0\" translate=noNotifications></a><notifications-bar></notifications-bar><span ng-if=user.users.length uib-dropdown><a translate=chooseUser uib-dropdown-toggle></a><ul class=dropdown-menu><li class=list-group-item ng-repeat=\"user in user.users track by user._id\"><user-card user=user ng-click=useUser(user)></user-card></li></ul></span> <a ng-show=user._id ng-click=logout() translate=logout></a></div></div>"),e.put("components/userCard/index.html",'<div class=user><div class=pull-left><img style=width:50px class="media-object clickable" ng-click=click(user); ng-src={{user.image}}></div><div class=media-body><h4 class=media-heading><a ng-click=click(user)>{{user.name || user.nick}}</a></h4><a ng-if=!href ng-href={{user.url}} target=_blank>{{user.url}}</a> <span ng-click=click(user) ng-if=href>{{user.url}}</span></div><div class=clearfix></div></div>'),e.put("components/votes/showVotes.html",'<div><div class=modal-header><h3 class=modal-title>{{votes.count}} crowdits</h3></div><div class=modal-body><ul class=list-group><li class=list-group-item ng-repeat="vote in votes.votes"><span class=pull-right ng-bind="vote.time | date:\'dd-MM-yyyy HH:mm\'"></span><h3 ng-bind=vote.vote class=pull-left></h3><user-card user=vote.user></user-card></li></ul></div><div class=modal-footer><button class="btn btn-warning" ng-click=$dismiss() translate=close></button></div></div>')}]),angular.module("crowdferenceApp").controller("AuthCtrl",["$scope","$interval","$cookies","User",function(e,t,n,a){var i=n.token,s=n.user,o=n.error,r=n.rolesHash;return delete n.token,delete n.user,delete n.error,delete n.rolesHash,a.landed=!1,a.progress=1,window.navigator.userAgent.match(/Windows Phone/)?(o?localStorage.error=o:(localStorage.token=i,localStorage.user=s,localStorage.rolesHash=r),void window.location.reload("/")):void t(function(){a.progress++},10,100).then(function(){o?localStorage.error=o:(localStorage.token=i,localStorage.user=s,localStorage.rolesHash=r),window.open(location,"_self").close()})}]),angular.module("crowdferenceApp").config(["$routeProvider",function(e){e.when("/sys/auth",{templateUrl:"app/auth/authview.html",controller:"AuthCtrl"})}]),angular.module("crowdferenceApp").config(["$routeProvider",function(e){e.when("/sys/login",{templateUrl:"app/login/login.html",controller:"loginCtrl"}).when("/sys/login/:token",{templateUrl:"app/login/loginCallback.html",controller:"loginCallbackCtrl"})}]).controller("loginCtrl",["$scope","$route","$location","$http","Question",function(e,t,n,a,i){var s=[{name:"twitter",icon:"tw.png",url:"/api/auth/twitter/redirect/"},{name:"google",icon:"g+.png",url:"https://accounts.google.com/o/oauth2/auth?client_id={{client_id}}&response_type=code&scope=profile email&redirect_uri={{protocol}}//{{host}}/api/auth/google"},{name:"facebook",icon:"fb.png",url:"https://www.facebook.com/dialog/oauth?client_id={{client_id}}&display=popup&scopes=basic_info&redirect_uri={{protocol}}//{{host}}/api/auth/facebook/"},{name:"linkedin",icon:"in.png",url:"https://www.linkedin.com/uas/oauth2/authorization?response_type=code&client_id={{client_id}}&scope=r_fullprofile r_emailaddress&state={{protocol}}&redirect_uri={{protocol}}//{{host}}/api/auth/linkedin"}];a.get("api/config/oauth").then(function(t){e.config=t.data.config,s.forEach(function(t){return e.config[t.name]?void(t.url=t.url.replace(/{{protocol}}/g,window.location.protocol).replace(/{{host}}/g,window.location.host).replace(/{{client_id}}/g,e.config[t.name])):void(t.url=!1)})}),e.oauths=s,n.search().target&&i.view.target?(e.user=i.view.target,e.oauths=s.filter(function(t){return t.name===e.user.profile.type}),localStorage.back="/question/"+i.view._id):e.user=!1,e.sendCode=function(t){a.post("/api/auth/email",{email:t}).then(function(t){e.hmac=t.data.hmac,e.session=t.data.session})},e.anyOauth=function(){return e.oauths.length},e.guest=function(){delete localStorage.firstCall,window.history.back()},localStorage.firstCall||e.user?(e.guest.title="landing.cancel.title",e.guest.button="landing.cancel.button"):(e.guest.title="landing.guest.title",e.guest.button="landing.guest.button")}]).controller("loginCallbackCtrl",["$scope","$location","$http","$route","User","$rootScope",function(e,t,n,a,i,s){if(s.wait=!0,localStorage.token=a.current.params.token,i.reload(),localStorage.firstCall){var o=JSON.parse(localStorage.firstCall);delete localStorage.firstCall;var r=o.shift(),c=o.shift();n[c].apply(n,o).then(function(e){return"post"===c&&o[0].match(/^\/api\/question\/[a-f0-9]{24}\/[a-f0-9]{24}$/)?void t.url("/question/"+e.data._id):void t.path(r)})}else t.path(localStorage.back||"/"),delete localStorage.back}]),angular.module("crowdferenceApp").config(["$routeProvider",function(e){e.when("/:area",{templateUrl:"app/main/main.html",controller:"MainCtrl",reloadOnSearch:!1})}]).controller("MainCtrl",["$scope","$title",function(e,t){t("crowdference")}]),angular.module("crowdferenceApp").config(["$routeProvider",function(e){e.when("/search/:user",{templateUrl:"app/search/search.html",controller:"SearchCtrl"})}]).controller("SearchCtrl",["$scope","$title","$route","User",function(e,t,n,a){t("crowdference"),"all"===n.current.params.user&&(a.view={})}]),angular.module("crowdferenceApp").config(["$routeProvider",function(e){e.when("/question/:question",{templateUrl:"app/question/question.html",controller:"QuestionCtrl",reloadOnSearch:!1,resolve:{question:["Question",function(e){return e.load()}]}})}]).controller("QuestionCtrl",["$scope","$title","Question","question","Area","$translate",function(e,t,n,a,i,s){e.question=a,_.empty(i.current),angular.extend(i.current,a.area),i.current.url=i.current.url||"_",e.checkVoted=n.checkVoted.bind(e.question),e.vote=n.vote.bind(e.question),e.index={question:e.question.question.length-1,answer:e.question.answer.length-1},e.maxIndex={question:e.question.question.length-1,answer:e.question.answer.length-1},e.save=n.save.bind(n),t(e.question.question[e.maxIndex.question].question),e.popup=function(e){s("share.text",{name:a.target.name}).then(function(t){var n=null,a=window.screenX||window.screenLeft,i=window.screenY||window.screenTop,s=window.outerWidth||document.body.clientWidth,o=window.outerHeight||document.body.clientHeight-22,r=700,c=500,l=parseInt(a+(s-r)/2,10),u=parseInt(i+(o-c)/2.5,10),d="width="+r+",height="+c+",left="+l+",top="+u;switch(e){case"twitter":n="https://twitter.com/intent/tweet?text="+t+encodeURIComponent("\n"+window.location.href);break;case"google":n="https://plus.google.com/share?url="+window.location.href;break;case"facebook":n="https://www.facebook.com/sharer.php?u="+encodeURIComponent(window.location.href)+"&t="+t}window.open(n,"_blank",d)})}}]),angular.module("crowdferenceApp").config(["$routeProvider",function(e){e.when("/user/:user/:area",{templateUrl:"app/user/user.view.html",controller:"userCtrl"})}]).controller("userCtrl",["$scope","User","Area","$title",function(e,t,n,a){t.load().then(function(t){e.user=t})}]),angular.module("crowdferenceApp").service("$title",["$rootScope","$location","$translate","ga",function(e,t,n,a){var i="",s={},o="",r=function(){return n(o,s).then(function(e){i=e,window.document.title=i})},c=function(e,n,c){return e?(s=n||{},o=e,r().then(function(){c||a("send","pageview",{page:t.url(),title:i})})):i};return e.$on("$translateChangeSuccess",function(){r(o,s)}),c}]),angular.module("crowdferenceApp").directive("area",["Area",function(e){return{templateUrl:"components/area/area.html",restrict:"E",controller:["$scope",function(t){t.area=e.current}]}}]),angular.module("crowdferenceApp").service("Area",["$rootScope","$q","$route","$location","$http",function(e,t,n,a,i){var s=this,o=t.when();this.current={},this.load=function(){n.current&&void 0!==n.current.params.area&&o.then(function(){var e=t.defer();return o=e.promise,i.get("/api/area/"+n.current.params.area).then(function(t){_.empty(s.current),angular.extend(s.current,t.data.area),s.current.url=s.current.url||"_",e.resolve(s)})["catch"](function(t){a.url("/"),e.reject(t)}),e.promise})},this.load(),e.$on("$locationChangeSuccess",function(){void 0!==n.current.params.area&&s.current.url!==n.current.params.area&&s.load()}),e.$on("login",function(){s.load()})}]),angular.module("crowdferenceApp").service("$auth",["$http","$q","$location",function(e,t,n){var a=this,i=!1;this.oauths=[{name:"twitter",icon:"tw.png",url:"/auth/twitter/redirect/"},{name:"google",icon:"g+.png",url:"https://accounts.google.com/o/oauth2/auth?client_id={{client_id}}&response_type=code&scope=profile email&redirect_uri={{protocol}}//{{host}}/auth/google&state={{protocol}}"},{name:"facebook",icon:"fb.png",url:"https://www.facebook.com/dialog/oauth?client_id={{client_id}}&display=popup&scopes=basic_info&redirect_uri={{protocol}}//{{host}}/auth/facebook/"},{name:"linkedin",icon:"in.png",url:"https://www.linkedin.com/uas/oauth2/authorization?response_type=code&client_id={{client_id}}&scope=r_fullprofile r_emailaddress&state={{protocol}}&redirect_uri={{protocol}}//{{host}}/auth/linkedin"}],this.anyOauth=function(){return a.oauths.some(function(e){return e.url})},this.loginDialog=function(e){e=e||"";var n=t.defer(),a=function(){void 0!==localStorage.token&&void 0!==localStorage.user&&void 0!==localStorage.rolesHash?(angular.element(window).off("storage",a),i=!1,n.resolve({isMain:!0,user:localStorage.user,rolesHash:localStorage.rolesHash})):localStorage.error&&(delete localStorage.error,n.reject({anonymous:!0}))},s=window.screenX||window.screenLeft,o=window.screenY||window.screenTop,r=window.outerWidth||document.body.clientWidth,c=window.outerHeight||document.body.clientHeight-22,l=730,u=610,d=parseInt(s+(r-l)/2,10),p=parseInt(o+(c-u)/2.5,10),g="width="+l+",height="+u+",left="+d+",top="+p,m=window.open("/sys/login?type="+e,"_blank",g);
return m.focus(),i===!1&&(i=!0,angular.element(window).on("storage",a)),n.promise},this.loginWith=function(e){var n=t.defer(),s=function(){void 0!==localStorage.token&&void 0!==localStorage.user&&void 0!==localStorage.rolesHash?(angular.element(window).off("storage",s),i=!1,n.resolve({isMain:!0,user:localStorage.user,rolesHash:localStorage.rolesHash})):localStorage.error&&(delete localStorage.error,n.reject({anonymous:!0}))},o=window.screenX||window.screenLeft,r=window.screenY||window.screenTop,c=window.outerWidth||document.body.clientWidth,l=window.outerHeight||document.body.clientHeight-22,u=700,d=500,p=parseInt(o+(c-u)/2,10),g=parseInt(r+(l-d)/2.5,10),m="width="+u+",height="+d+",left="+p+",top="+g,h=null;return h=e.code?window.open("/auth/email?hmac="+e.hmac+"&session="+e.session+"&code="+e.code,"_blank",m):window.open(a.oauths[e].url,"_blank",m),h.focus(),i===!1&&(i=!0,angular.element(window).on("storage",s)),n.promise},this.startup=function(){var a=n.search();if(a.use)return e.post("/api/user/use/"+a.use).then(function(e){return e=e.data,sessionStorage.rolesHash=e.rolesHash_,sessionStorage.user=a.use,sessionStorage.token=e.token,{user:a.use,rolesHash:sessionStorage.rolesHash,isMain:!1}});if(sessionStorage.token&&sessionStorage.user&&sessionStorage.rolesHash)return t.when({isMain:!1,user:sessionStorage.user,rolesHash:sessionStorage.rolesHash});if(localStorage.token&&localStorage.user&&localStorage.rolesHash)return t.when({isMain:!0,user:localStorage.user,rolesHash:localStorage.rolesHash});delete localStorage.token,delete localStorage.user,delete localStorage.rolesHash,delete sessionStorage.user,delete sessionStorage.rolesHash,delete sessionStorage.token;var i=!!sessionStorage.landed;return sessionStorage.landed=!0,t.reject({anonymous:!0,landed:i})},e.get("/api/config/oauth").success(function(e){a.oauths.forEach(function(t){return e.config[t.name]?void(t.url=t.url.replace(/{{protocol}}/g,window.location.protocol).replace(/{{host}}/g,window.location.host).replace(/{{client_id}}/g,e.config[t.name])):void(t.url=!1)})})}]).config(["$httpProvider",function(e){e.interceptors.push(["$q","$rootScope",function(e,t){return{request:function(e){return localStorage.token&&e.url.match(/^\/api/)&&(e.headers=e.headers||{},e.params=e.params||{},e.headers["X-AUTH-TOKEN"]=localStorage.token,e.headers["X-AUTH-AS"]=e.headers["X-AUTH-AS"]||sessionStorage.user),e.url.match(/\/typeahead[\/?]/)||(t.wait=!0),e},responseError:function(n){return t.wait=!1,401===n.status&&(localStorage.clear(),window.location="/"),502===n.status&&(t.outOfService=!0),e.reject(n)},response:function(e){return t.wait=!1,e}}}])}]),angular.module("crowdferenceApp").directive("comment",["$compile",function(e){return{templateUrl:"components/comments/comment.html",restrict:"E",compile:function(t){var n,a=t.contents().remove();return function(t,i){n||(n=e(a)),n(t,function(e){i.append(e)})}},controller:["$scope","$element","markdown","$timeout",function(e,t,n,a){e.newComment=" #"+e.comment.count+" \n",e.toogleNewComment=function(){e.status.respond||e.newComment||(e.newComment=" #"+e.comment.count+" \n"),e.status.respond=!e.status.respond},e.index=e.comment.comment.length-1;var i=function(t){var a=t.replace(/#(\d+)/g,'<a class="btn btn-sm" ng-click="goToComment($1)" mouseenter-delayed="showComment($event,$1)" mouseenter-delay="1000">#$1</a>');return{html:n(a),$scope:e}};e.render=i,e.status={},e.childrenToggle=function(){void 0===e.status.showChildren?(e.status.showChildren=!1,a(function(){e.status.showChildren=!0})):e.status.showChildren=!e.status.showChildren}}]}}]),angular.module("crowdferenceApp").directive("comments",function(){return{templateUrl:"components/comments/comments.html",restrict:"E",controller:["$scope","User","$http","$anchorScroll","$location","$popup",function(e,t,n,a,i,s){e.goToComment=function(e){angular.element("#comment-"+e)&&(i.hash("comment-"+e),a())},e.showComment=function(t,n){return e.question.comments.comments[n-1]?s({template:"<comment></comment>",scope:{comment:e.question.comments.comments[n-1],question:e.question},x:t.pageX,y:t.pageY,width:$(t.currentTarget).parents(".comment").width()}):void 0},e.vote=function(n,a){var i=e.checkVoted(n);a!==i&&(a===-i&&(a=0),t.$http.post("/api/comments/"+n._id+"/"+a).then(function(e){n.votes=e.data.votes}))},e.checkVoted=function(e){var n=null;return e.votes.votes.some(function(e){return e.user._id===t.user._id?(n=e.vote,!0):void 0}),n};var o=/#\d+/g;e.tree=function(){e.question.comments.comments.forEach(function(e){var t=e.comment[e.comment.length-1].comment.match(o);null!==t&&t.forEach(function(t){t=t.substr(1)-1,this[t]&&(this[t].children=this[t].children||[],this[t].children.push(e))},this)},e.question.comments.comments)},e.edit=function(e,t){return n.put("/api/comments/"+e._id,{comment:t})},e.tree()}]}}),angular.module("crowdferenceApp").directive("newComment",function(){return{templateUrl:"components/comments/newComment.html",restrict:"E",controller:["$scope","$http","User",function(e,t,n){e.save=function(){n.$http.post("/api/comments/"+e.question._id,{comment:e.newComment}).then(function(t){e.question.comments=t.data.comments,e.newComment="",e.status&&(e.status.respond=!1),e.tree()})}}]}}),angular.module("crowdferenceApp").directive("historyEditable",["User","$compile","$timeout",function(e,t,n){return{templateUrl:"components/historyEditable/historyEditable.html",restrict:"E",scope:{user:"=",history:"=",what:"@",save:"&",render:"&?",hideBar:"@",controls:"=?",current:"=?"},controller:["$scope","$attrs","$element",function(e,a,i){var s=e.history.length-1,o=s,r={editing:!1,edit:function(){r.editing={value:e.current[e.what]}},cancel:function(){r.editing=!1},ok:function(){e.save({$value:r.editing.value}).then(function(){var t={timestamp:Date.now()};t[e.what]=r.editing.value,e.history.push(t),r.editing=!1,s+=1,r.show(s)})["catch"](r.cancel)},next:function(){r.show(o+1)},prev:function(){r.show(o-1)},hasnext:function(){return s>o},hasprev:function(){return o>0},show:function(t){o=t,e.current=e.history[o],r.renderize&&r.renderize()}};a.render&&(r.renderize=function(){var n=e.render({$content:e.current[e.what]});i.find(".historyview").empty().append(t(n.html)(n.$scope||e))},n(r.renderize)),r.show(s),e.controls=r,-1===s&&(r.editing={value:""})}]}}]),angular.module("crowdferenceApp").directive("typeaheadSearch",function(){return{require:["ngModel"],restrict:"A",scope:{typeaheadSearch:"="},link:function(e,t,n,a){e.typeaheadSearch&&(e.typeaheadSearch.callback=function(e){return a[0].$setViewValue(e),e})}}}).controller("inlineQuestionSearchCtrl",["$scope","$modalInstance","$http","Area","Question","question",function(e,t,n,a,i,s){e.question=s,e.Area=a,e.status="searching",n.get("/api/search/"+s.target._id+"/all/target",{params:{topic:s.question}}).success(function(n){e.status="done",0===n.questions.length&&t.close(),e.questions=n.questions}).error(function(){t.close()}),e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]).directive("inlineQuestion",function(){return{templateUrl:"components/inlineQuestion/inlineQuestion.html",restrict:"E",replace:!0,scope:{},controller:["$q","$scope","$http","$location","$element","$timeout","$uibModal","User","markdown","Area",function(e,t,n,a,i,s,o,r,c,l){t.$watch(function(){return r.view._id},function(){r.view._id&&(l.current.custom&&l.current.custom.targets?t.updateTargets().then(function(){t.targets.some(function(e){return r.view._id===e._id})&&(t.question.target=r.view)}):t.question.target=r.view)}),t.typesearch={},t.isLogged=r.isLogged,t.markdown=c,t.question={question:""},t.Area=l.current,t.questionActive=!0,t.updateTargets=function(){return n.get("/api/area/"+l.current.url+"/targets/typeahead?q=").then(function(e){t.targets=e.data.targets})},t.getSuggestions=function(e){return e.match(/^ .*/)?n.get("/api/auth/search?q="+e).then(function(e){return e.data.users.length?e.data.users:[{notFound:!0}]},function(){return[{notFound:!0}]}):e?n.get("/api/area/"+l.current.url+"/targets/typeahead?q="+e).then(function(t){return t.data.targets.push({search:e}),t.data.targets}):[]},t.select=function(e){return e.search?t.typesearch.callback(" "+e.search):e.notFound?"":(t.question.target=e,"")},t.chooseAgain=function(){t.question.target={},s(function(){i.children("input").focus()})},t.crowdIt=function(){if(u()){if(t.question.target._id){var e=o.open({templateUrl:"components/inlineQuestion/search.html",controller:"inlineQuestionSearchCtrl",size:"lg",resolve:{question:function(){return t.question}}});return void e.result.then(function(){p()},function(){t.question={question:""}})}d()}};var u=function(){var e=function(){return t.error=!0,!1};return""===t.question["short"]?e():(t.error=!1,!0)},d=function(){n.put("/api/auth/"+t.question.target.profile.type,{uid:t.question.target.profile.uid+""}).then(function(e){t.question.target=e.data.user,p()})},p=function(){r.$http.post("/api/question/"+l.current._id+"/"+t.question.target._id,{question:{"short":t.question.question}}).then(function(e){a.url("/question/"+e.data._id)})}}]}}),angular.module("crowdferenceApp").directive("languages",function(){return{templateUrl:"components/languages/index.html",restrict:"E",replace:!0,controller:["$scope","$translate","$http",function(e,t,n){n.get("https://rawgit.com/crowdference/babel/master/translations.json").then(function(t){e.translations=t.data}),e.use=t.use}]}}),angular.module("crowdferenceApp").directive("leftBar",function(){return{templateUrl:"components/leftBar/leftBar.html",restrict:"E",replace:!0,controller:["$element","$swipe",function(e,t){var n=!1,a=null,i=window.innerWidth,s=850>i,o=0,r=!1,c=function(){i=window.innerWidth,s&&i>850&&e.css({left:0}),s=850>i},l=function(){r=!1,n=!0,a=null,e.css({left:o})};$(window).resize(c),t.bind(angular.element(window.document),{start:function(e,t){s&&(r=!1,n=!1,a=e)},cancel:l,move:function(t,i){if(s&&!n&&a){var c=t.x-a.x;if(!r&&Math.abs(t.y-a.y)>Math.abs(c))return l();r=!0;var u=o+c;-320>u&&(u=-320),u>0&&(u=0),e.css({left:u})}},end:function(e,t){if(s&&!n){var i=e.x-a.x;o=-160>o+i?-320:0,l()}}})}]}}),angular.module("crowdferenceApp").service("markdown",["marked",function(e){return function(t){return t=t||"",t=window.toMarkdown(t),t=t.replace(/&gt;/g,">"),t=t.replace(/&lt;/g,"<"),t=window.toMarkdown(t),e(t)}}]),angular.module("crowdferenceApp").directive("markdownArea",["markdown","$timeout",function(e,t){return{restrict:"E",templateUrl:"components/markdownArea/markdownArea.html",replace:!0,scope:{ngModel:"=?",active:"=?",ngChange:"@?",render:"&?",edit:"&?",editable:"&?",view:"&?",placeholder:"@",multiline:"=?",markdown:"=?"},link:function(n,a){var i=a.children(".markdownAreaEditResize"),s=a.children(".markdownAreaView"),o=a.children(".markdownAreaEdit"),r=function(){("function"!=typeof n.edit||n.edit()!==!1)&&(a.addClass("active"),n.active=!0,t(function(){o[0].focus()}),a.css("height",i.css("height")))},c=function(){if("function"!=typeof n.view||n.view()!==!1){a.removeClass("active"),n.active=!1;var t=n.render&&n.render()||e(n.ngModel);n.markdown=t.compiled||t,s.empty().append(n.markdown),a.css("height",s.css("height"))}};n.ngModel=n.ngModel||"",n.active=n.active||!1,a.addClass("markdownArea"),n.$watch("active",function(){n.active?r():c()}),n.$watch("ngModel",function(){a.css("height",i.css("height")),o.css("height",i.css("height")),n.active?r():c(),n.ngModel?a.removeClass("isEmpty"):a.addClass("isEmpty")}),n.$watch(function(){return n.editable&&n.editable()},function(e){e?a.addClass("editable clickable"):a.removeClass("editable clickable")}),n.multiline===!1&&o.keydown(function(e){13===e.keyCode&&e.preventDefault()}),s.on("click",r),o.on("blur",c),o.on("paste",function(e){e.preventDefault();var t=e.originalEvent.clipboardData.getData("text/html")||e.originalEvent.clipboardData.getData("text/plain");t=window.toMarkdown(t),t=t.replace(/<[^>]*?>/g,""),n.multiline===!1&&(t=t.replace(/\n/g," "));try{document.execCommand("insertText",!1,t)}catch(a){var i=e.currentTarget;i.value=i.value.substring(0,i.selectionStart)+t+i.value.substring(i.selectionEnd,i.value.length)}}),t(function(){n.active?r():c()},500),o.bind("focus",function(){n.active=!0}),o.bind("blur",function(){n.active=!1}),n.$on("login",function(){t(function(){n.active?r():c()})})}}}]),angular.module("crowdferenceApp").directive("mouseenterDelayed",["$timeout","$parse",function(e,t){return{restrict:"A",link:function(n,a,i){var s=!1,o=function(a){s=e(function(){t(i.mouseenterDelayed)(n,{$event:a})},n.$eval(i.mouseenterDelay)||1e3)},r=function(){e.cancel(s)};a.on("mouseenter",o).on("mouseleave",r)}}}]),angular.module("crowdferenceApp").directive("mouseleaveDelayed",["$timeout","$parse",function(e,t){return{restrict:"A",link:function(n,a,i){window.attrs=i,window.scope=n;var s=!1,o=function(a){s=e(function(){t(i.mouseleaveDelayed)(n,{$event:a})},n.$eval(i.mouseleaveDelay)||1e3)},r=function(){e.cancel(s)};a.on("mouseleave",o).on("mouseenter",r)}}}]),angular.module("crowdferenceApp").directive("paramsNav",function(){return{templateUrl:"components/paramsNav/paramsNav.html",restrict:"E",replace:!0,translate:!0,scope:{key:"@"},controller:["$scope","Questions","$route",function(e,t,n){e.params=t.params,"as"===e.key?e.$on("$locationChangeSuccess",function(){e.hide=void 0===n.current.params.user||"all"===n.current.params.user,e.options=n.current.params.area?["user","target","votes"]:["user","target","all"]}):e.options={which:["all","answer","question"],sort:["last","24h","1w","1m","1y","ever"]}[e.key]}]}}),angular.module("crowdferenceApp").service("$popup",["$rootScope","$compile","$timeout",function(e,t,n){var a=function(e,t){var a=this.popup,i=this.config;n(function(){var n=i.element[0].getBoundingClientRect().left,s=i.element[0].getBoundingClientRect().top,o=25,r=25,c=angular.element(window).width()<a.outerWidth()+e,l=angular.element(window).height()<a.outerHeight()+t-angular.element(window).scrollTop();e=c?e-n-a.outerWidth()+o:e-n-o,t=l?t-s-a.outerHeight()-angular.element(window).scrollTop()+r:t-s-angular.element(window).scrollTop()-r,a.css({left:e+"px",top:t+"px"})})},i={template:"<div></div>",parent:e,scope:{},element:angular.element(window.document.body)},s=function(e){e=angular.extend({},i,e);var n=e.parent.$new(!1);angular.extend(n,e.scope);var s=t('<div mouseleave-delayed="$close()" class="popup"></div>')(n),o=t(e.template)(n);return e.width&&s.width(e.width),e.x&&e.y&&a.call({popup:s,config:e},e.x,e.y),n.$close=function(){s.remove(),n.$destroy()},e.element.append(s),s.append(o),{popup:s,element:o,close:n.close,at:a.bind({popup:s,config:e})}};return s}]),angular.module("crowdferenceApp").directive("primary",["Questions",function(e){return{templateUrl:"components/primary/primary.html",restrict:"E",controller:["$scope","$route","$location",function(t,n,a){t.Questions=e;var i,s,o=function(n){e.load({first:n,topic:a.search().topic}).then(function(e){t.questions=e.questions,s=e.prevPage,i=e.nextPage})};t.$on("$locationChangeSuccess",function(){n.current.params.area&&o()}),t.$on("login",function(){o()}),o(),t.$watch("Questions.params",function(){o()},!0),t.next=function(){o(i)},t.prev=function(){o(s)}}]}}]),angular.module("crowdferenceApp").service("Question",["$location","User","$route","$q","$http",function(e,t,n,a,i){var s=this;this.view={},this.checkVoted=function(){return this.votes.votes.some(function(e){return e.user._id===t.user._id&&1===e.vote})},this.vote=function(){var e=s.checkVoted.call(this)?"0":"1";t.$http.put("/api/question/"+this._id+"/"+e).then(function(e){this.votes=e.data.votes}.bind(this))},this.save=function(e,n){return t.$http.put("/api/question/"+this.view._id+"/"+e,{what:n}).then(function(e){"answer"===n&&(this.view.isAnswered=!0)}.bind(this))};var o=!1;this.load=function(){return n.current.params.question===this.view._id?a.when(this.view):(o||(o=t.loading.then(function(){return i.get("/api/question/"+n.current.params.question).then(function(e){return o=!1,this.view=e.data.question,this.view}.bind(this))["catch"](function(){o=!1})}.bind(this))),o)}}]),angular.module("crowdferenceApp").directive("questionCard",function(){return{templateUrl:"components/questionCard/questionCard.html",restrict:"E",replace:!0,controller:["$scope","Question",function(e,t){e.checkVoted=t.checkVoted.bind(e.question),e.vote=t.vote.bind(e.question)}]}}),angular.module("crowdferenceApp").service("Questions",["$http","$route",function(e,t){var n;this.params={which:"all",sort:"24h",as:"target"},this.load=function(a){if(n)return n;a=angular.extend({},this.params,a);var i,s;return t.current.params.area?("all"===a.as&&(a.as="target"),i="/api/questions/"+t.current.params.area,i=t.current.params.user?i+"/"+t.current.params.user+"/"+a.which+"/"+a.as+"/"+a.sort:i+"/"+a.which+"/"+a.sort,s={size:a.size,first:a.first}):("votes"===a.as&&(a.as="target"),i="/api/search/",i="all"!==t.current.params.user?i+"/"+t.current.params.user+"/"+a.which+"/"+a.as:i,s={size:a.size,first:a.first,topic:a.topic}),n=e.get(i,{params:s}).then(function(e){return n=!1,e.data})["catch"](function(){n=!1})}}]),angular.module("crowdferenceApp").directive("searchBox",function(){return{templateUrl:"components/searchBox/searchBox.html",restrict:"E",replace:!0,controller:["$scope","$location","$route",function(e,t,n){e.search=function(){t.$$search={topic:e.topic},t.$$path="/search/"+(n.current.params.user||"all"),t.$$compose()}}]}}),angular.module("crowdferenceApp").directive("topBar",function(){return{templateUrl:"components/topBar/topBar.html",restrict:"E",replace:!0,controller:["$scope","Area",function(e,t){e.area=t.current}]}}),angular.module("crowdferenceApp").directive("userView",function(){return{templateUrl:"components/user/user.html",restrict:"E",controller:["$scope","User","$title",function(e,t,n){t.load().then(function(){e.user=t.view,n(t.user.name||t.user.nick)}),e.findUser=t.findUser,e.addManager=t.addManager,e.removeManager=t.removeManager}]}}),angular.module("crowdferenceApp").service("User",["$rootScope","$translate","$http","$location","$route","$q",function(e,t,n,a,i,s){var o=this,r=!1,c=function(){r||t("login").then(function(e){o.user.name=e})},l=function(e){r=!!e._id,_.empty(o.user),angular.extend(o.user,e)},u=function(){_.empty(o.user),r=!1,o.user.image="/assets/images/user.png",o.user.users=[],c()};this.user={},this.logout=this.logout=function(){sessionStorage.clear(),localStorage.clear(),window.location.reload()};var d=function(e,t,i,o){return r?n[this](e,t,i,o):(localStorage.firstCall=JSON.stringify([a.path(),this,e,t,i,o]),a.path("/sys/login"),s.reject())};this.$http={get:d.bind("get"),post:d.bind("post"),put:d.bind("put"),"delete":d.bind("delete")},this.loginAs=function(e){a.path("/sys/login?type="+e.profile.type)},this.useUser=function(e){this.user.use=e,sessionStorage.user=e._id},this.findUser=function(e){return n.get("/api/user/typeahead?q="+e).then(function(e){return e.data.users})},this.addManager=function(e){n.post("/api/user/manager/"+e._id).then(function(){this.user.managers.push(e)}.bind(this))},this.removeManager=function(e){n["delete"]("/api/user/manager/"+this.user.managers[e]._id).then(function(){this.user.managers.splice(e,1)}.bind(this))},this.view={};var p=!1;this.load=function(){return p=this.loading.then(function(){return"all"===i.current.params.user?(this.view={},s.when(this.view)):i.current.params.user===this.user._id?(this.view=this.user,s.when(this.view)):i.current.params.user===this.view._id?s.when(this.view):p?void 0:n.get("/api/user/"+i.current.params.user).then(function(e){return p=!1,this.view=e.data.user,this.view}.bind(this))["catch"](function(){p=!1})}.bind(this))},this.reload=function(){e.$on("$translateChangeSuccess",c),localStorage.token?this.loading=n.get("/api/user").then(function(e){l(e.data.user)})["catch"](function(){localStorage.clear(),u()}):(this.loading=s.when(),u())},this.reload()}]),angular.module("crowdferenceApp").directive("userArea",function(){return{templateUrl:"components/userArea/userArea.html",restrict:"E",replace:!0,controller:["$scope","User",function(e,t){e.user=t.user,e.logout=t.logout,e.login2=t.loggedRequired,e.useUser=t.useUser,e.removeNotification=function(e){t.notifications.splice(e,1)}}]}}),angular.module("crowdferenceApp").directive("userCard",function(){return{restrict:"E",templateUrl:"components/userCard/index.html",replace:!0,scope:{user:"=",href:"@?"},controller:["$rootScope","$scope",function(e,t){t.href?t.click=function(){window.location=t.href}:t.click=e.goToUser}]}});